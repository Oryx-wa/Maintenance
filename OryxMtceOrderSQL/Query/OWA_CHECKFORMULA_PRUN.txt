
DECLARE @tcFormula nVarchar(1000), @tcPrunCd nVarChar(10)

SET @tcFormula = 'OWAPARAM1'
SET @tcPrunCd = 'OWAPARAM2'

DECLARE @WageCode varChar(30)
DECLARE @Rowcount int

SELECT @rowcount = COUNT(code) FROM [@OWA_PRUNWAGE]
WHERE U_lFormula = 'N' AND U_PrunCd=@tcPrunCd


DECLARE Wage_Cursor CURSOR FOR
SELECT code FROM [@OWA_PRUNWAGE]
WHERE U_lFormula = 'N'  AND U_PrunCd=@tcPrunCd

	
OPEN Wage_Cursor

	

FETCH NEXT FROM Wage_Cursor
INTO @wagecode

DECLARE @lcTable nvarchar(1000)
DECLARE @lcInsert Varchar(200), @lcValues varchar(200)
DECLARE @Count int
	
SET @Count = 1

SET @lcTable = 'CREATE TABLE #tempWage ('

SET @lcInsert = 'INSERT #tempWage ('

SET @lcValues = '  VALUES ('

WHILE @@FETCH_STATUS = 0
BEGIN

				
	SET @lcTable = @lcTable +'[' + @WageCode + ']'+ ' Money'
	SET @lcInsert = @lcInsert +'[' + @WageCode + ']' 
	SET @lcValues = @lcValues + '1' 
	IF @Count <> @Rowcount 
	BEGIN
		SET @lcTable = @lcTable + ','
		SET @lcInsert = @lcInsert + ','
		SET @lcValues = @lcValues + ',' 
	END
	ELSE
	BEGIN
		SET @lcTable = @lcTable + ')'
		SET @lcInsert = @lcInsert + ')'
		SET @lcValues = @lcValues + ')' 
	END
	SET @Count = @Count + 1		
	FETCH NEXT FROM Wage_Cursor
	INTO @wagecode
END	

CLOSE Wage_Cursor
DEALLOCATE Wage_Cursor


SET @lcTable  = @lcTable + CHAR(13) + CHAR(10) +  CHAR(13) + CHAR(10) +  @lcInsert + @lcValues
SET @lcTable = @lcTable + CHAR(13) + CHAR(10)  + 'DECLARE @Test money '  + CHAR(13) + CHAR(10)
SET @lcTable  = @lcTable + N'SELECT @Test = ' + @tcFormula + ' FROM #tempWage'

EXECUTE sp_executesql   @lcTable


IF @@ERROR <> 0 
BEGIN
	SELECT TOP 1 'N' AS Ret FROM [@OWA_PRUNWAGE] WHERE 1=1
END
ELSE
BEGIN
	SELECT TOP 1 'Y' AS Ret FROM [@OWA_PRUNWAGE] WHERE 1=1
END

 

