Declare @p1 nVarchar(MAX),
	@p2 int	

Set @p1 = 'OWAPARAM1'
SET @P2=OWAPARAM2


if @p2 = 1
	BEGIN 
		SELECT  empid , b.u_xcode ,
			b.firstname ,b.lastname , 
			a.Code
			FROM [@OWA_empprun] a join ohem b ON a.U_empid = b.empid
			Where U_PrunCd=@p1
			ORDER BY 1
	END
	IF @p2 = 2
	BEGIN
		SELECT  empid ,b.u_xcode ,
				b.firstname, b.lastname 
				
			FROM  ohem b 
			WHERE empid NOT IN (SELECT a.U_empid 
								FROM [@OWA_empprun] a join ohem b ON a.U_empid = b.empid
								WHERE u_pruncd = @p1)
			ORDER BY 1
	END
	if @p2 = 3
	BEGIN 
		SELECT  empid ,b.u_xcode, b.firstname , 
				b.lastname  
				
		FROM  ohem b 	
		WHERE empid NOT IN (SELECT  c.empid 
		FROM [@OWA_Salaryhistory] a JOIN ( SELECT a.U_Empid,MAX(U_efdate) AS U_efdate
				FROM [@OWA_salaryhistory] a JOIN OHEM b
					ON a.U_empid = b.empid					
				GROUP BY a.U_Empid) b 
						ON a.U_Empid = b.U_Empid AND a.U_efdate = b.U_efdate
						JOIN OHEM c ON a.U_empid = c.empid
						JOIN [@OWA_personwage] d ON a.code = d.U_salcode						
		WHERE d.U_wagecode = @p1 )
		ORDER BY 1
					
	END
	











